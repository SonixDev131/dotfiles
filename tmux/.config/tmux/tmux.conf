# Terminal and color settings
set-option -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "tmux-256color"
set -g mouse on

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Vim style pane selection
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Show pane titles
set -g pane-border-status top
set -g pane-border-format "#[fg=$thm_blue,bg=$thm_black] #{?pane_active,üî•,‚ö°} #P: #{pane_current_command} "

# Beautiful clock mode (prefix + t)
set -g clock-mode-colour "$thm_blue"
set -g clock-mode-style 24

# Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Shift arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# Shift Alt vim keys to switch windows
bind -n M-H previous-window
bind -n M-L next-window

# ===== THEME COLORS =====
# Dracula/Tokyo Night inspired colors
thm_bg="#1a1b26"
thm_fg="#c0caf5"
thm_cyan="#7dcfff"
thm_black="#15161e"
thm_gray="#414868"
thm_magenta="#bb9af7"
thm_pink="#f7768e"
thm_red="#f7768e"
thm_green="#9ece6a"
thm_yellow="#e0af68"
thm_blue="#7aa2f7"
thm_orange="#ff9e64"
thm_black4="#565f89"

# ===== PANE BORDERS =====
set -g pane-border-style "fg=$thm_gray"
set -g pane-active-border-style "fg=$thm_blue"

# ===== MESSAGE STYLING =====
set -g message-style "bg=$thm_orange,fg=$thm_black"
set -g message-command-style "bg=$thm_orange,fg=$thm_black"

# ===== STATUS BAR =====
set -g status-interval 60
set -g status-position bottom
set -g status-justify left
set -g status-style "bg=$thm_bg,fg=$thm_fg"
set -g status-left-length 100
set -g status-right-length 120

# Left side with powerline separators
set -g status-left "#[fg=$thm_black,bg=$thm_blue,bold] Û∞ä† #S #[fg=$thm_blue,bg=$thm_gray] #[fg=$thm_fg,bg=$thm_gray] #I:#P #[fg=$thm_gray,bg=$thm_bg] "

# Window status formatting
set -g window-status-format "#[fg=$thm_gray,bg=$thm_bg] #[fg=$thm_fg,bg=$thm_gray] #I #[fg=$thm_fg,bg=$thm_gray]#W #[fg=$thm_gray,bg=$thm_bg] "
set -g window-status-current-format "#[fg=$thm_bg,bg=$thm_orange] #[fg=$thm_black,bg=$thm_orange,bold] #I #[fg=$thm_black,bg=$thm_orange,bold]#{b:pane_current_path} #[fg=$thm_orange,bg=$thm_bg] "
set -g window-status-separator ""

# Enhanced window status with activity indicators
set -g monitor-activity on
set -g visual-activity off
set -g window-status-activity-style "fg=$thm_yellow,bg=$thm_bg,bold"

# Right side with icons and powerline
set -g status-right "#[fg=$thm_gray,bg=$thm_bg] #[fg=$thm_fg,bg=$thm_gray] ‚õÖ #(curl -s wttr.in/Hanoi?format=%%t 2>/dev/null || echo 'N/A') #[fg=$thm_blue,bg=$thm_gray] #[fg=$thm_black,bg=$thm_blue] üìÖ %d-%m #[fg=$thm_green,bg=$thm_blue] #[fg=$thm_black,bg=$thm_green] üïê #(TZ='Asia/Ho_Chi_Minh' date +%%H:%%M) #[fg=$thm_magenta,bg=$thm_green] #[fg=$thm_black,bg=$thm_magenta,bold] s0n1xd3v ü§ì "

# ===== COPY MODE =====
set-window-option -g mode-style "bg=$thm_blue,fg=$thm_black"

# Vi mode
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ===== PLUGINS =====
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'

# ===== CUSTOM BINDINGS =====
bind-key -r f run-shell "tmux neww ~/bin/.local/scripts/tmux-sessionizer"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Quick Notes & Todo setup with better styling
bind -r e split-window -h "nvim ~/Documents/git/scratch/notes_$(date +'%Y%m%d%H').md"
bind -r v split-window -h -c "#{pane_current_path}" "zsh -c 'nvim; exec zsh'"
bind -r o split-window -h "nvim ~/Documents/git/scratch/todo_$(date +'%y%m%d').md"

run '~/.tmux/plugins/tpm/tpm'
